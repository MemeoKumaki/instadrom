<div class="container">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <div>
        <%= render 'form' %>
      </div>
      <div>

        <% @posts.each do |post| %>

        <div class="post">

          <h3 class="clearfix"><%= post.user.name %>
            <% if current_user == post.user %>
            <div class="btn-group pull-right ">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Post <span class="glyphicon glyphicon-option-vertical"></span>
              </button>
              <ul class="dropdown-menu">
                <li><%= link_to 'Edit', edit_post_path(post) %></li>
                <li role="separator" class="divider"></li>
                <li><%= link_to 'Delete', post_path(post), method: :delete, data: { confirm: "Аre you sure? The deleted post cannot be restored later" } %></li>
              </ul>
            </div>
            <% end %>
          </h3>

          <%= image_tag post.image.url(:medium) %>
          <div><%= render 'likes/form', p: post %></div>
          <hr>
          <% if post.likes.count != 0 %>
          <p><%= post.likes.count %> like<% if post.likes.count > 1 %>s <% end %></p>
          <% else %>
          <p>No likes yet</p>
          <% end %>
          <p><%= post.body %></p>
          <% if post.comments.size > 0 %>
          <% post.comments.each do |comment| %>
          <div class="comment">
            <h4>
              <%= comment.user.name %>
              <% if current_user == comment.user %>
              <div class="btn-group pull-right ">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <span class="glyphicon glyphicon-option-vertical"></span>
                </button>
                <ul class="dropdown-menu">
                  <li><%= link_to 'Edit', edit_comment_path(comment) %></li>
                  <li role="separator" class="divider"></li>
                  <li><%= link_to 'Delete', comment_path(comment), method: :delete, data: { confirm: "Аre you sure? The deleted comment cannot be restored later" } %></li>
                </ul>
              </div>
              <% elsif current_user == post.user %>
              <%= link_to 'X', comment_path(comment), class: 'pull-right', method: :delete, data: { confirm: "Аre you sure? The deleted comment cannot be restored later" } %>
              <% end %>
            </h4>
            <p><%= comment.body %></p>
          </div>
          <% end %>
          <% else %>
          <p>Be the first one to comment it!</p>
          <% end %> 
          <div>
            <%= render 'comments/form', p: post %>
          </div>
        </div>
        <% end %>
      </div>
    </div>
  </div>
</div>